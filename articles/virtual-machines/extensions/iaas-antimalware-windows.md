---
title: Extensão Microsoft antimalware para VMs do Windows no Azure
description: Implante a extensão de Antimalware do Azure na máquina virtual do Windows usando uma extensão.
services: virtual-machines
documentationcenter: ''
author: TerryLanfear
manager: rkarlin
editor: ''
ms.assetid: ''
ms.service: virtual-machines
ms.subservice: extensions
ms.collection: windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 02/23/2021
ms.author: terrylan
ms.openlocfilehash: 0ed5d7b1367d40fa5769fc26acfdddf941fea4cc
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/19/2021
ms.locfileid: "104596341"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>Extensão de Antimalware da Microsoft para Windows

## <a name="overview"></a>Visão geral

O panorama atual de ameaças a ambientes de nuvem é extremamente dinâmico, aumentando a pressão sobre assinantes de nuvem de TI comercial para manter uma proteção eficaz e atender aos requisitos de conformidade e segurança na nuvem. O Microsoft Antimalware para Azure é uma funcionalidade de proteção em tempo real gratuita que ajuda a identificar e remover vírus, spyware e outros softwares mal-intencionados, com alertas configuráveis quando softwares mal-intencionados ou indesejados conhecidos tentam se instalar ou ser executados nos sistemas do Azure. A solução baseia-se na mesma plataforma de antimalware do MSE (Microsoft Security Essentials), do Microsoft Forefront Endpoint Protection, do Microsoft System Center Endpoint Protection, do Windows Intune e do Windows Defender para Windows 8.0 e posterior.
O Antimalware da Microsoft para Azure é uma solução de agente único para aplicativos e ambientes de locatário, projetado para ser executado em segundo plano sem intervenção humana. Você pode implantar a proteção baseada nas necessidades de suas cargas de trabalho do aplicativo, com configuração básica padronizada ou personalizada avançada, incluindo monitoramento de antimalware.

## <a name="prerequisites"></a>Pré-requisitos

### <a name="operating-system"></a>Sistema operacional

A solução Microsoft Antimalware para Azure inclui o Cliente e o Serviço Microsoft Antimalware, o modelo de implantação clássico do Antimalware, cmdlets do PowerShell do Antimalware e a Extensão Diagnóstico do Azure. A solução Microsoft Antimalware tem suporte no Windows Server 2008 R2, no Windows Server 2012 e nas famílias de sistemas operacionais Windows Server 2012 R2. Não há suporte no sistema operacional Windows Server 2008 e também não há suporte no Linux. 

O Windows Defender é o Antimalware interno habilitado no Windows Server 2016. A Interface do Windows Defender também é habilitada por padrão em alguns Windows Server 2016 SKU.
A extensão de Antimalware de VM do Azure ainda pode ser adicionada a uma VM do Azure do Windows Server 2016 com o Windows Defender, mas nesse cenário, a extensão será aplicada a qualquer política de configuração a ser usada pelo Windows Defender, a extensão não implantará qualquer serviço de antimalware adicional. Leia mais sobre essa atualização [aqui](/archive/blogs/azuresecurity/update-to-azure-antimalware-extension-for-cloud-services).

### <a name="internet-connectivity"></a>Conectividade com a Internet

O Antimalware da Microsoft para o Windows exige que a máquina virtual de destino esteja conectada à internet para receber o mecanismo e as atualizações regulares de assinatura. 

## <a name="template-deployment"></a>Implantação de modelo
Extensões de VM do Azure podem ser implantadas com modelos do Azure Resource Manager. Modelos são ideais ao implantar uma ou mais máquinas virtuais que exigem configuração pós-implantação, tal como integração ao Azure Antimalware.

A configuração do JSON para uma extensão da máquina virtual pode ser aninhado dentro do recurso de máquina virtual ou localizado no nível de raiz ou superior de um modelo JSON do Resource Manager. O posicionamento da configuração do JSON afeta o valor do tipo e nome do recurso. Para obter mais informações, consulte [Definir o nome e o tipo de recursos filho](../../azure-resource-manager/templates/child-resource-name-type.md). 

O exemplo a seguir pressupõe que a extensão de VM está aninhada dentro do recurso de máquina virtual. Ao aninhar o recurso de extensão, o JSON é colocado no objeto `"resources": []` da máquina virtual.

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2019-07-01",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".log;.ldf",
            "Paths": "D:\\IISlogs;D:\\DatabaseLogs",
            "Processes": "mssence.svc"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```

## <a name="powershell-deployment"></a>Implantação do PowerShell
Depende do tipo de implantação, use comandos correspondentes para implantar a extensão de máquina virtual do Azure Antimalware para uma máquina virtual existente.

  * [Máquina virtual baseada em Azure Resource Manager](../../security/fundamentals/antimalware-code-samples.md#enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms)
  * [Clusters de Service Fabric do Azure](../../security/fundamentals/antimalware-code-samples.md#add-microsoft-antimalware-to-azure-service-fabric-clusters)
  * [Serviço de nuvem clássico](/powershell/module/servicemanagement/azure.service/set-azureserviceextension)

## <a name="troubleshoot-and-support"></a>Solução de problemas e suporte

### <a name="troubleshoot"></a>Solucionar problemas

Logs de extensão do Microsoft Antimalware estão disponíveis em - %Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware(Or PaaSAntimalware)\1.5.5.x(version#)\CommandExecution.log

### <a name="error-codes-and-their-meanings"></a>Códigos de erro e seus significados

| Código do erro | Significado | Ação possível |
| :---: | --- | --- |
| -2147156224 | MSI está ocupado com uma instalação diferente | Tente executar a instalação do último |
| -2147156221 | A instalação do MSE já está em execução | Executar apenas uma instância de cada vez |
| -2147156208 | Pouco espaço em disco < 200 MB | Excluir arquivos não utilizados e tentar novamente a instalação |
| -2147156187 | Última instalação, atualização, atualizar ou desinstalar reinicialização solicitada | Reiniciar e tentar novamente a instalação |
| -2147156121 | A instalação tentou remover o produto concorrente. Mas o produto concorrente falhou na desinstalação | Tente remover o produto concorrente manualmente, reinicialize e repita a instalação  |
| -2147156116 | Falha na validação do arquivo de Política | Verifique se você passa um arquivo XML de política válido para a instalação  |
| -2147156095 | A instalação não pôde iniciar o serviço de Antimalware | Verifique se todos os binários são assinados corretamente e licenciamento de arquivo correto estão instalados |
| -2147023293 | Um erro fatal ocorreu durante a instalação. Em muitos casos, ocorrerá. EPP.msi, não é possível register\start\stop AM serviço ou mini driver de filtro | Logs do MSI de EPP.msi são necessários aqui para investigação futura |
| -2147023277 | Não foi possível abrir o pacote de instalação | Verifique se o pacote existe, e é acessível, ou contate o fornecedor do aplicativo para verificar se este é um pacote válido do Windows Installer |
| -2147156109 | Defender é necessário como um pré-requisito |  |
| -2147205073 | Não há suporte para o emissor websso | |
| -2147024893 | O sistema não pode localizar o caminho especificado |  |
| -2146885619 | Não criptografada ou a mensagem de criptografia não está formatada corretamente |  |
| -1073741819 | A instrução em 0x%p memória referenciada em 0x%p. A memória não pôde ser %s |  |
| 1 | Função Incorreta |  |


### <a name="support"></a>Suporte

Caso precise de mais ajuda em qualquer ponto deste artigo, entre em contato com os especialistas do Azure nos [fóruns do Azure e do Stack Overflow no MSDN](https://azure.microsoft.com/support/forums/). Como alternativa, você pode registrar um incidente de suporte do Azure. Vá para o [site de suporte do Azure](https://azure.microsoft.com/support/options/)e selecione obter suporte. Para saber mais sobre como usar o suporte do Azure, leia as [Perguntas frequentes sobre o suporte do Microsoft Azure](https://azure.microsoft.com/support/faq/).