---
title: Microsoft Antimalware para Azure | Microsoft Docs
description: Este artigo fornece uma visão geral da arquitetura do Microsoft Antimalware para Azure, incluindo cenários com suporte e configurações para habilitar, configurar e implantar proteção para os Serviços de Nuvem do Azure e Máquinas Virtuais. Abordaremos a configuração básica, o gerenciamento e o monitoramento de funcionalidade acessível por meio de APIs de gerenciamento de serviços do Microsoft Azure, PowerShell scripts, o portal do Azure e o Visual Studio.
services: security
documentationcenter: na
author: barclayn
manager: barbkess
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2019
ms.author: barclayn
ms.openlocfilehash: a57dd07d0fe52b3dbbf4c3827d3e5d21945e75ee
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60611495"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais

O Microsoft Antimalware para Azure é uma proteção em tempo real que ajuda a identificar e remover vírus, spyware e outros softwares mal-intencionados. Ele gera alertas quando um software mal-intencionado ou indesejado conhecido tenta se instalar ou executar nos sistemas do Azure.

A solução baseia-se na mesma plataforma de antimalware do Microsoft Security Essentials \[MSE\], do Microsoft Forefront Endpoint Protection, do Microsoft System Center Endpoint Protection, do Windows Intune e do Windows Defender para Windows 8.0 e posterior. O Antimalware da Microsoft para Azure é uma solução de agente único para aplicativos e ambientes de locatário, projetado para ser executado em segundo plano sem intervenção humana. É possível implantar a proteção com base nas necessidades das cargas de trabalho do aplicativo, com configuração básica padronizada ou personalizada avançada, incluindo monitoramento de antimalware.

Quando você implanta e habilita o Microsoft Antimalware do Azure para seus aplicativos, os seguintes recursos principais ficam disponíveis:

* **Proteção em tempo real** - monitora a atividade em Serviços de Nuvem e em máquinas virtuais para detectar e bloquear a execução de malware.
* **Verificação agendada** - Faz a verificação periodicamente para detectar malware, incluindo programas ativamente em execução.
* **Remediação de Malware** - atua automaticamente sobre o malware detectado, por exemplo, excluindo ou colocando arquivos mal-intencionados em quarentena e limpando entradas de Registro mal-intencionadas.
* **Atualizações de assinatura** - instala automaticamente as últimas assinaturas de proteção (definições de vírus) para garantir que a proteção seja atualizada em uma frequência predeterminada.
* **Atualizações de mecanismo Antimalware** - atualiza automaticamente o mecanismo Microsoft Antimalware.
* **Atualizações da plataforma Antimalware** - atualiza automaticamente a plataforma Microsoft Antimalware.
* **Proteção ativa** - reporta metadados de telemetria sobre ameaças detectadas e recursos suspeitos ao Microsoft Azure para garantir uma resposta rápida ao panorama de ameaças em constante evolução, além de habilitar a entrega de assinatura síncrona em tempo real por meio do MAPS (Microsoft Active Protection System).
* **Relatórios de exemplos** - fornece e relata exemplos para o serviço Microsoft Antimalware para ajudar a aprimorar o serviço e a habilitar a solução de problemas.
* **Exclusões** – permite que os administradores de serviço e aplicativo configurem exclusões para os arquivos, processos e unidades.  
* **Coleta de eventos de antimalware** - registra a integridade do serviço de antimalware, atividades suspeitas e ações de remediação realizadas no log de eventos do sistema operacional e os coleta na conta do Armazenamento do Azure do cliente.

> [!NOTE]
> O Microsoft Antimalware também podem ser implantado usando a Central de Segurança do Azure. Leia [Instalar o Endpoint Protection na Central de Segurança do Azure](../security-center/security-center-install-endpoint-protection.md) para saber mais.

## <a name="architecture"></a>Arquitetura

O Microsoft Antimalware para Azure inclui o Cliente e o Serviço Microsoft Antimalware, o modelo de implantação clássico do Antimalware, cmdlets do PowerShell do Antimalware e a Extensão Diagnóstico do Azure. O Microsoft Antimalware tem suporte no Windows Server 2008 R2, no Windows Server 2012 e nas famílias de sistemas operacionais Windows Server 2012 R2. Não há suporte no sistema operacional Windows Server 2008 e também não há suporte no Linux.

O cliente e serviço Microsoft Antimalware é instalado por padrão em estado desabilitado em todas as famílias de sistema operacional convidado do Azure com suporte na plataforma de Serviços de Nuvem. O cliente e serviço Microsoft Antimalware não é instalado por padrão na plataforma Máquinas Virtuais e está disponível como um recurso opcional nas configurações do Portal do Azure e da Máquina Virtual do Visual Studio em Extensões de Segurança.

Ao usar o Serviço de Aplicativo do Azure, o serviço subjacente que hospeda o aplicativo Web tem o Microsoft Antimalware habilitado nele. Isso é usado para proteger a infraestrutura do Serviço de Aplicativo do Azure e não é executado no conteúdo do cliente.

> [!NOTE]
> O Windows Defender é o Antimalware interno habilitado no Windows Server 2016. A Interface do Windows Defender também é habilitada por padrão em alguns Windows Server 2016 SKU [consulte aqui para obter mais informações](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016). A extensão de Antimalware de VM do Azure ainda pode ser adicionada a uma VM do Azure do Windows Server 2016 com o Windows Defender, mas nesse cenário, a extensão será aplicada a qualquer [política de configuração](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe) opcional a ser usada pelo Windows Defender, a extensão não implantará nenhum serviço de antimalware adicional.
> Leia mais sobre essa atualização [aqui](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/).

### <a name="microsoft-antimalware-workflow"></a>Fluxo de trabalho do Microsoft Antimalware

O administrador do serviço Azure pode habilitar Antimalware para o Azure com configuração padrão ou personalizada para suas Máquinas Virtuais e Serviços de Nuvem usando as seguintes opções:

* Máquinas Virtuais – no portal do Azure, em **Extensões de Segurança**
* Máquinas Virtuais – usando a configuração de máquinas virtuais do Visual Studio no Gerenciador de Servidores
* Máquinas Virtuais e Serviços de Nuvem – usando o [modelo de implantação clássico](https://msdn.microsoft.com/library/azure/ee460799.aspx) do Antimalware
* Máquinas Virtuais e Serviços de Nuvem – usando cmdlets Antimalware do PowerShell

O portal do Azure ou os cmdlets do PowerShell enviam por push o arquivo de pacote de extensão de Antimalware no sistema do Azure para determinada localização fixa. O agente convidado do Azure (ou o agente de malha) inicia a extensão do Antimalware, aplicando as configurações de Antimalware fornecidas como entrada. Esta etapa habilita o serviço  Antimalware com configurações personalizadas ou padrão. Se nenhuma configuração personalizada for fornecida, o serviço de antimalware estará habilitado com as configurações padrão. Consulte a seção *Configuração do Antimalware* em [Microsoft Antimalware para Azure – exemplos de código](https://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e exemplos de código de VMs") para obter mais detalhes.

Quando em execução, o cliente Microsoft Antimalware baixa as definições mais recentes de mecanismo e assinatura de proteção da Internet e carrega-as no sistema do Azure. O serviço Microsoft Antimalware grava eventos relacionados ao serviço no log de eventos de sistema operacional do sistema, na origem de evento "Microsoft Antimalware". Eventos incluem o estado de integridade, de proteção e atualização do cliente Antimalware, configurações novas e antigas, atualizações de mecanismos, definições de assinatura e outros.

Você pode habilitar o monitoramento de Antimalware para seu Serviço de Nuvem ou Máquina Virtual para que os eventos de log de eventos de Antimalware sejam gravados conforme vão sendo gerados para sua conta de armazenamento do Azure. O serviço Antimalware usa a extensão de diagnóstico do Azure para coletar eventos de Antimalware do sistema do Azure e colocar em tabelas na conta de armazenamento do Azure do cliente.

O fluxo de trabalho de implantação, incluindo etapas de configuração e opções com suporte para os cenários acima, está documentado na seção [Cenários de implantação de antimalware](#antimalware-deployment-scenarios) deste documento.

![Microsoft Antimalware no Azure](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> No entanto, você pode usar o Powershell/APIs e modelos do Azure Resource Manager para implantar Conjuntos de Escala de Máquina Virtual com a extensão de Antimalware da Microsoft.  Para instalar uma extensão em uma Máquina Virtual já em execução, você pode usar o script Python de exemplo [vmssextn.py](https://github.com/gbowerman/vmsstools). Esse script obtém a configuração de extensão existente no Conjunto de Escala e adiciona uma extensão à lista de extensões existentes nos Conjuntos de Escala de VM.
>
>

### <a name="default-and-custom-antimalware-configuration"></a>Configuração de Antimalware personalizada e padrão

As configurações padrão são aplicadas para habilitar o Antimalware para os Serviços de Nuvem do Azure ou Máquinas Virtuais quando você não fornecer as configurações personalizadas. As configurações padrão foram previamente otimizadas para execução no ambiente do Azure. Opcionalmente, você pode personalizar essas configurações padrão conforme necessário para seu aplicativo ou implantação do serviço do Azure e aplicá-las em outros cenários de implantação.

A tabela a seguir resume as configurações disponíveis para o serviço Antimalware. As configurações padrão estão marcadas na coluna abaixo rotulada como "Padrão".

![Tabela 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>Cenários de implantação de antimalware

Os cenários para habilitar e configurar o antimalware, incluindo monitoramento de Serviços de Nuvem do Azure e Máquinas Virtuais, são discutidos nesta seção.

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Máquinas virtuais – habilitar e configurar o antimalware

#### <a name="deployment-while-creating-a-vm-using-the-azure-portal"></a>Implantação durante a criação de uma VM usando o portal do Azure

Para habilitar e configurar o Microsoft Antimalware para Máquinas Virtuais do Azure usando o portal do Azure ao provisionar uma Máquina Virtual, siga as etapas abaixo:

1. Entre no Portal do Azure em <https://portal.azure.com>.
2. Para criar uma nova máquina virtual, navegue até **Máquinas virtuais**, selecione **Adicionar**e escolha **Windows Server**.
3. Selecione a versão do Windows Server que você deseja usar.
4. Selecione **Criar**.
    ![Criar máquina virtual](./media/azure-security-antimalware/create-vm.PNG)
5. Forneça um **Nome**, **Nome de usuário**, **Senha**e crie um novo grupo de recursos ou escolha um grupo de recursos existente.
6. Selecione **Ok**.
7. Escolha um tamanho de VM.
8. Na próxima seção, faça as escolhas apropriadas para suas necessidades e selecione a seção **Extensões**.
9. Selecione **Adicionar extensão**
10. Em **Novo recurso**, escolha **Microsoft Antimalware**.
11. Escolha **Criar**
12. Na seção **instalar extensão**, arquivos, locais e exclusões de processo podem ser configurados, bem como outras opções de verificação. Escolha **Ok**.
13. Escolha **Ok**.
14. Na seção **Configurações**, escolha **Ok**.
15. Na tela **Criar**, escolha **Ok**.

#### <a name="deployment-using-the-visual-studio-virtual-machine-configuration"></a>Implantação usando a configuração de máquina virtual do Visual Studio

Para habilitar e configurar o serviço Microsoft Antimalware usando o Visual Studio:

1. Conecte-se ao Microsoft Azure no Visual Studio.

2. Escolha sua Máquina Virtual no nó **Máquinas Virtuais** no **Gerenciador de Servidores**

   ![Configuração da Máquina Virtual no Visual Studio](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3. Clique com botão direito do mouse em **Configurar** para exibir a página de configuração da Máquina Virtual

4. Selecione a extensão **Microsoft Antimalware** na lista suspensa em **Extensões Instaladas** e clique em **Adicionar** para definir com a configuração de antimalware padrão.
    ![Extensões instaladas](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)
5. Para personalizar a configuração de Antimalware padrão, selecione (realce) a extensão do Antimalware na lista de extensões instaladas e clique em **Configurar**.

6. Substitua a configuração de Antimalware padrão com sua configuração personalizada no formato JSON com suporte na caixa de texto **configuração pública** e clique em OK.

7. Clique no botão **Atualizar** para enviar as atualizações de configuração para a Máquina Virtual.

    ![Extensão de configuração de máquina virtual](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

> [!NOTE]
>A configuração de Máquinas Virtuais do Visual Studio para Antimalware dá suporte somente à configuração no formato JSON. O modelo de definições de configuração de Antimalware JSON está incluído no [Microsoft Antimalware para Azure – Exemplos de código](https://aka.ms/amazsamples "Microsoft Antimalware para Azure – Exemplos de código"), que mostra as definições de configuração de Antimalware com suporte.

#### <a name="deployment-using-powershell-cmdlets"></a>Implantação Usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft Antimalware para máquinas virtuais do Azure usando cmdlets do PowerShell.

Para habilitar e configurar o Microsoft Antimalware usando cmdlets de antimalware do PowerShell:

1. Configurar o ambiente do PowerShell – consulte a documentação em <https://github.com/Azure/azure-powershell>
2. Use o [cmdlet Antimalware Set-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension) para habilitar e configurar o Microsoft Antimalware para sua Máquina Virtual.

> [!NOTE]
>A configuração de Máquinas Virtuais do Azure para Antimalware dá suporte somente à configuração no formato JSON. O modelo de definições de configuração de Antimalware JSON está incluído no [Microsoft Antimalware para Azure – Exemplos de código](https://aka.ms/amazsamples "Microsoft Antimalware para Azure – Exemplos de código"), que mostra as definições de configuração de Antimalware com suporte.

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>Habilitar e configurar o Antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft Antimalware para Serviços de Nuvem do Azure usando cmdlets do PowerShell. Observe que o Microsoft Antimalware é instalado em um estado desabilitado na plataforma Serviços de Nuvem e requer uma ação de um aplicativo do Azure para habilitá-lo.

Para habilitar e configurar o Microsoft Antimalware usando o cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell – consulte a documentação em <https://github.com/Azure/azure-powershell>
2. Use o [cmdlet Antimalware Set-AzureServiceAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension) para habilitar e configurar o Microsoft Antimalware para seu Serviço de Nuvem.

O modelo de definições de configuração de Antimalware XML está incluído no [Microsoft Antimalware para Azure – Exemplos de código](https://aka.ms/amazsamples "Microsoft Antimalware para Azure – Exemplos de código"), que mostra as definições de configuração de Antimalware com suporte.

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Serviços de Nuvem e Máquinas Virtuais – configuração usando cmdlets do PowerShell

Um aplicativo ou serviço Azure pode recuperar a configuração do Microsoft Antimalware para Serviços de Nuvem e Máquinas Virtuais usando cmdlets do PowerShell.

Para recuperar a configuração do Microsoft Antimalware usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell – consulte a documentação em <https://github.com/Azure/azure-powershell>
2. **Para Máquinas Virtuais**: Use o [cmdlet Get-AzureVMMicrosoftAntimalwareExtension Antimalware](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azurevmmicrosoftantimalwareextension) para obter a configuração antimalware.
3. **Para Serviços de Nuvem**: Use o [Get-AzureServiceAntimalwareConfig Antimalware](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azureserviceantimalwareconfig) para obter a configuração Antimalware.

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>Remover a configuração de Antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço Azure pode remover a configuração de monitoramento de Antimalware e configurações de monitoramento de Antimalware associadas do Azure Antimalware e extensões de serviço de diagnóstico relevantes associados ao Serviço de Nuvem ou à Máquina Virtual.

Para remover o Microsoft Antimalware usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell – consulte a documentação em <https://github.com/Azure/azure-powershell>
2. **Para Máquinas Virtuais**: Use o [cmdlet Remove-AzureVMMicrosoftAntimalwareExtension Antimalware](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azurevmmicrosoftantimalwareextension).
3. **Para Serviços de Nuvem:** Use o cmdlet [Remove-AzureServiceAntimalwareExtension Antimalware](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azureserviceantimalwareextension).

Para **habilitar** a coleta de eventos de antimalware para uma máquina virtual usando a Versão Prévia do Portal do Azure:

1. Clique em qualquer parte da Lente monitoramento na folha de Máquina Virtual
2. Clique no comando Diagnóstico na folha Métrica
3. Selecione **Status** Ativo (ON) e verifique a opção para sistema de eventos do Windows
4. . Você pode optar por desmarcar todas as outras opções na lista ou deixá-las habilitadas de acordo com as suas necessidades de serviço do aplicativo.
5. As categorias de eventos de Antimalware "Erro", "Aviso", "Informativo" e outras são capturadas na sua conta de armazenamento do Azure.

Os eventos de antimalware são coletados dos logs de sistema de eventos do Windows para sua conta de armazenamento do Azure. Você pode configurar a conta de armazenamento para que sua Máquina Virtual colete eventos de antimalware selecionando a conta de armazenamento apropriado.

![Métricas e diagnóstico](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Para saber mais sobre como log de diagnósticos para Antimalware do Azure, leia [Habilitando o log de diagnóstico para o Azure Antimalware](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/).

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>Habilitar e configurar o monitoramento de antimalware usando cmdlets do PowerShell

Você pode habilitar a coleção de eventos de Microsoft Antimalware para seu Serviço de Nuvem ou Máquina Virtual usando o diagnóstico do Azure por meio de cmdlets de Antimalware do PowerShell. A extensão de diagnóstico do Azure pode ser configurada para capturar eventos da fonte do log de eventos do sistema "Microsoft Antimalware" à sua conta de armazenamento do Azure. As categorias de eventos de Antimalware "Erro", "Aviso", "Informativo" e outras são capturadas na sua conta de armazenamento do Azure.

Para habilitar a coleta de eventos de Antimalware para sua conta de armazenamento do Azure usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell – consulte <https://github.com/Azure/azure-powershell>
2. **Para Máquinas Virtuais** - Use o [cmdlet Antimalware Set-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension) com a opção Monitoramento Ativado.
3. **Para Serviços de Nuvem** - Use o cmdlet [Antimalware Set-AzureServiceAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension) com opção Monitoramento Ativado.

Você pode exibir os eventos brutos Antimalware ao analisar a tabela *WADWindowsEventLogsTable* na sua conta do Armazenamento do Azure configurada para habilitar o monitoramento de Antimalware. Isso pode ser útil para validar que a coleta de eventos de antimalware está funcionando, incluindo a obtenção de informações sobre a integridade do serviço de antimalware. Para obter mais informações, incluindo o código de exemplo que mostra como extrair eventos de Antimalware da conta de armazenamento, consulte [Microsoft Antimalware para Azure – Exemplos de código](https://aka.ms/amazsamples "Microsoft Antimalware para Azure – Exemplos de Código").
