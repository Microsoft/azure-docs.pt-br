---
title: Avaliação de vulnerabilidade do SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Saiba como configurar a avaliação de vulnerabilidades do SQL e interpretar os relatórios de avaliação no banco de dados SQL do Azure, Azure SQL Instância Gerenciada e Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/19/2021
ms.locfileid: "100376557"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>A avaliação de vulnerabilidades do SQL ajuda a identificar vulnerabilidades de banco de dados
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

A avaliação de vulnerabilidades do SQL é um serviço fácil de configurar que pode descobrir, acompanhar e ajudá-lo a corrigir possíveis vulnerabilidades no banco de dados. Use-a para melhorar de forma proativa a segurança do seu banco de dados.

A avaliação de vulnerabilidades faz parte da oferta do [Azure defender para SQL](azure-defender-for-sql.md) , que é um pacote unificado para recursos avançados de segurança do SQL. A avaliação de vulnerabilidade pode ser acessada e gerenciada por meio do portal central do Azure defender para SQL.

> [!NOTE]
> A avaliação de vulnerabilidade tem suporte para o banco de dados SQL do Azure, o Azure SQL Instância Gerenciada e o Azure Synapse Analytics. O banco de dados do Azure SQL Instância Gerenciada e o Azure Synapse Analytics são mencionados coletivamente no restante deste artigo como bancos de dados, e o servidor está se referindo ao [servidor](logical-servers.md) que hospeda os bancos de dados do Azure SQL Database e do Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>O que é a avaliação de vulnerabilidades do SQL?

A avaliação de vulnerabilidades do SQL é um serviço que fornece visibilidade do seu estado de segurança. A avaliação de vulnerabilidade inclui etapas acionáveis para resolver problemas de segurança e aprimorar a segurança do banco de dados. Ele pode ajudá-lo a monitorar um ambiente de banco de dados dinâmico onde as alterações são difíceis de rastrear e melhorar sua postura de segurança do SQL.

A avaliação de vulnerabilidade é um serviço de verificação incorporado ao banco de dados SQL do Azure. O serviço emprega uma base de dados de conhecimento de regras que sinaliza vulnerabilidades de segurança. Ele realça os desvios das práticas recomendadas, como configurações incorretas, permissões excessivas e dados confidenciais não protegidos.

As regras se baseiam nas práticas recomendadas da Microsoft e se concentram nos problemas de segurança que apresentam os maiores riscos ao seu banco de dados e seus valiosos. Eles abordam problemas no nível do banco de dados e problemas de segurança no nível do servidor, como configurações de firewall do servidor e permissões de nível de servidor.

Os resultados da verificação incluem etapas práticas para resolver cada problema e fornecer scripts de correções personalizadas quando aplicável. Você pode personalizar um relatório de avaliação para seu ambiente definindo uma linha de base aceitável para:

- Configurações de permissão
- Configurações de recurso
- Configurações de banco de dados

## <a name="configure-vulnerability-assessment"></a>Configura a avaliação de vulnerabilidade

Execute as seguintes etapas para configurar a avaliação de vulnerabilidade:

1. No [portal do Azure](https://portal.azure.com), abra o recurso específico no banco de dados SQL do Azure, no banco de dados SQL instância gerenciada ou no Azure Synapse.

1. No título **segurança** , selecione **central de segurança**.

1. Selecione **Configurar** no link para abrir o painel de configurações do Azure defender para SQL para todo o servidor ou instância gerenciada.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Abrindo a configuração do defender para SQL":::

    > [!NOTE]
    > A avaliação de vulnerabilidade do SQL requer que o **Azure defender para o plano do SQL** possa executar verificações. Para obter mais informações sobre como habilitar o Azure defender para SQL, consulte [Azure defender para SQL](azure-defender-for-sql.md).

1. Na página **configurações do servidor** , defina as configurações do Azure defender para SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Configurando as verificações de avaliação de vulnerabilidade do SQL":::

    1. Configure uma conta de armazenamento na qual os resultados da verificação para todos os bancos de dados no servidor ou instância gerenciada serão armazenados. Para saber mais sobre as contas de armazenamento, confira [Sobre as contas de armazenamento do Azure](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Para obter mais informações sobre como armazenar verificações de avaliação de vulnerabilidade por trás de firewalls e VNets, consulte [armazenar vulnerabilidades de exame de avaliação resulta em uma conta de armazenamento acessível por trás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).

    1. Para configurar avaliações de vulnerabilidade para executar verificações semanais automaticamente para detectar incorretas configurações de segurança, defina **verificações recorrentes periódicas** para **ativado**. Os resultados são enviados para os endereços de email que você fornecer em **enviar relatórios de verificação para** o. Você também pode enviar notificações por email para administradores e proprietários de assinatura habilitando **também notificação de email para administradores e proprietários de assinatura**.

1. As verificações de avaliação de vulnerabilidade do SQL também podem ser executadas sob demanda:

    1. Na página central de **segurança** do recurso, selecione **Exibir descobertas adicionais na avaliação de vulnerabilidade** para acessar os resultados da verificação de verificações anteriores.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Abrindo os resultados da verificação e as opções de verificação manual":::

    1. Para executar uma varredura sob demanda para verificar se há vulnerabilidades no banco de dados, selecione **examinar** na barra de ferramentas:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Selecione examinar para executar uma verificação de avaliação de vulnerabilidade sob demanda de seu recurso SQL":::


  > [!NOTE]
  > A verificação é leve e segura. Leva alguns segundos para ser executado e é inteiramente somente leitura. Ele não faz nenhuma alteração no banco de dados.

## <a name="remediate-vulnerabilities"></a>Corrigir vulnerabilidades

Quando uma verificação de vulnerabilidade é concluída, o relatório é exibido no portal do Azure. O relatório apresenta:

- Uma visão geral do seu estado de segurança
- O número de problemas encontrados e
- Um resumo por gravidade dos riscos
- Uma lista das descobertas para investigações adicionais

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Relatório de verificação de sampl do verificador de avaliação de vulnerabilidade do SQL":::

Para corrigir as vulnerabilidades descobertas:

1. Examine os resultados e determine quais das descobertas do relatório são problemas de segurança verdadeiros para o seu ambiente.

1. Selecione cada resultado com falha para entender seu impacto e por que a verificação de segurança falhou.

    > [!TIP]
    > A página de detalhes de conclusões inclui informações de correção acionáveis que explicam como resolver o problema.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Examinando as conclusões de uma verificação de vulnerabilidade":::

1. Ao examinar os resultados da avaliação, você pode marcar resultados específicos como uma linha de *base* aceitável em seu ambiente. Uma linha de base é essencialmente uma personalização de como os resultados são relatados. Nas verificações subsequentes, os resultados que correspondem à linha de base são considerados como passagens. Depois de estabelecer seu estado de segurança de linha de base, a avaliação de vulnerabilidades só relata os desvios da linha de base. Dessa forma, você pode concentrar sua atenção nos problemas relevantes.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Aprovando uma localização como uma linha de base para verificações futuras":::

1. Se você alterar as linhas de base, use o botão **examinar** para executar uma varredura sob demanda e exibir o relatório personalizado. Todas as descobertas que você adicionou à linha de base serão exibidas **agora com uma** indicação de que elas passaram devido às alterações de linha de base.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Avaliações passadas indicando que passaram por linha de base personalizada":::

Suas verificações de avaliação de vulnerabilidade agora podem ser usadas para garantir que seu banco de dados mantenha um alto nível de segurança e que suas políticas organizacionais sejam atendidas. 

## <a name="advanced-capabilities"></a>Recursos avançados

### <a name="export-an-assessment-report"></a>Exportar um relatório de avaliação

Selecione **Exportar resultados da verificação** para criar um relatório do Excel para download do resultado da verificação. Este relatório contém uma guia Resumo que exibe um resumo da avaliação. O relatório inclui todas as verificações com falha. Ele também inclui uma guia **resultados** que contém o conjunto completo de resultados da verificação. Os resultados incluem todas as verificações que foram executadas e os detalhes de resultado de cada uma.

### <a name="view-scan-history"></a>Exibir o histórico de verificação

Selecione **histórico de verificação** no painel avaliação de vulnerabilidade para exibir um histórico de todas as verificações executadas anteriormente neste banco de dados. Selecione uma verificação específica na lista para exibir os resultados detalhados dessa verificação.

## <a name="manage-vulnerability-assessments-programmatically"></a>Gerenciar avaliações de vulnerabilidade programaticamente

### <a name="using-azure-powershell"></a>Usando o PowerShell do Azure

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo Azure Resource Manager do PowerShell ainda tem suporte, mas todo o desenvolvimento futuro é para o módulo AZ. Sql. Para esses cmdlets, confira [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Você pode usar os cmdlets do Microsoft Azure PowerShell para gerenciar suas avaliações de vulnerabilidade de forma programática. Os cmdlets com suporte são:

| Nome do cmdlet como um link | Descrição |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidades.<br/>Primeiro, defina a linha de base antes de usar este cmdlet para limpá-la. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidade de um banco de dados gerenciado.<br/>Primeiro, defina a linha de base antes de usar este cmdlet para limpá-la. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de uma instância gerenciada. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Converte os resultados da verificação de avaliação de vulnerabilidade de um banco de dados em um arquivo do Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Converte os resultados da verificação de avaliação de vulnerabilidade de um banco de dados gerenciado em um arquivo do Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a linha de base da regra de avaliação de vulnerabilidade de um banco de dados para uma determinada regra. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a linha de base da regra de avaliação de vulnerabilidade de um banco de dados gerenciado para uma determinada regra. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados gerenciado. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Retorna as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Retorna as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de avaliação de vulnerabilidades. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de avaliação de vulnerabilidade para um banco de dados gerenciado. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Dispara o início de uma verificação de avaliação de vulnerabilidade em um banco de dados. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Dispara o início de uma verificação de avaliação de vulnerabilidade em um banco de dados gerenciado. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de uma instância gerenciada. |
| &nbsp; | &nbsp; |

Para obter um exemplo de script, consulte [suporte do PowerShell de avaliação de vulnerabilidade do SQL do Azure](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Usando modelos do Resource Manager

Para configurar as linhas de base de avaliação de vulnerabilidade usando modelos de Azure Resource Manager, use o `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` tipo.

Certifique-se de que você tenha habilitado `vulnerabilityAssessments` antes de adicionar linhas de base.

Aqui está um exemplo para definir a regra de linha de base VA2065 para o `master` banco de dados e VA1143 para o `user` banco de dados como recursos em um modelo do Resource Manager:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Para `master` banco de dados e `user` banco de dados, os nomes de recursos são definidos de forma diferente:

- Banco de dados mestre-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]",
- User Database-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Default</b>')]",

Para tratar tipos booleanos como true/false, defina o resultado da linha de base com a entrada binária, como "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Próximas etapas  

- Saiba mais sobre o [Azure Defender para SQL](azure-defender-for-sql.md).
- Saiba mais sobre a [descoberta e a classificação de dados](data-discovery-and-classification-overview.md).
- Saiba mais sobre como [armazenar os resultados da verificação de avaliação de vulnerabilidade em uma conta de armazenamento acessível por trás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).