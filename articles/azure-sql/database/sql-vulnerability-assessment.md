---
title: Avaliação de Vulnerabilidades SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Saiba como configurar a avaliação de vulnerabilidades do SQL e interpretar os relatórios de avaliação no banco de dados SQL do Azure, Azure SQL Instância Gerenciada e Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 09/21/2020
tags: azure-synapse
ms.openlocfilehash: 67258a19d1efe605a3a0b2227f107cc1928a207a
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/07/2021
ms.locfileid: "99806385"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>A avaliação de vulnerabilidades do SQL ajuda a identificar vulnerabilidades de banco de dados
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

A avaliação de vulnerabilidades do SQL é um serviço fácil de configurar que pode descobrir, acompanhar e ajudá-lo a corrigir possíveis vulnerabilidades no banco de dados. Use-a para melhorar de forma proativa a segurança do seu banco de dados.

A avaliação de vulnerabilidades faz parte da oferta do [Azure defender para SQL](azure-defender-for-sql.md) , que é um pacote unificado para recursos avançados de segurança do SQL. A avaliação de vulnerabilidade pode ser acessada e gerenciada por meio do portal central do Azure defender para SQL.

> [!NOTE]
> A avaliação de vulnerabilidade tem suporte para o banco de dados SQL do Azure, o Azure SQL Instância Gerenciada e o Azure Synapse Analytics. O banco de dados do Azure SQL Instância Gerenciada e o Azure Synapse Analytics são mencionados coletivamente no restante deste artigo como bancos de dados, e o servidor está se referindo ao [servidor](logical-servers.md) que hospeda os bancos de dados do Azure SQL Database e do Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>O que é a avaliação de vulnerabilidades do SQL?

A avaliação de vulnerabilidades do SQL é um serviço que fornece visibilidade do seu estado de segurança. A avaliação de vulnerabilidade inclui etapas acionáveis para resolver problemas de segurança e aprimorar a segurança do banco de dados. Ele pode ajudá-lo a monitorar um ambiente de banco de dados dinâmico onde as alterações são difíceis de rastrear e melhorar sua postura de segurança do SQL.

A avaliação de vulnerabilidade é um serviço de verificação incorporado ao banco de dados SQL do Azure. O serviço emprega uma base de dados de conhecimento de regras que sinaliza vulnerabilidades de segurança. Ele realça os desvios das práticas recomendadas, como configurações incorretas, permissões excessivas e dados confidenciais não protegidos.

As regras se baseiam nas práticas recomendadas da Microsoft e se concentram nos problemas de segurança que apresentam os maiores riscos ao seu banco de dados e seus valiosos. Eles abordam problemas no nível do banco de dados e problemas de segurança no nível do servidor, como configurações de firewall do servidor e permissões de nível de servidor.

Os resultados da verificação incluem etapas práticas para resolver cada problema e fornecer scripts de correções personalizadas quando aplicável. Você pode personalizar um relatório de avaliação para seu ambiente definindo uma linha de base aceitável para:

- Configurações de permissão
- Configurações de recurso
- Configurações de banco de dados

## <a name="configure-vulnerability-assessment"></a>Configura a avaliação de vulnerabilidade

As etapas a seguir configuram a avaliação de vulnerabilidade:

1. Acesse o banco de dados SQL do Azure, o banco de dados do SQL Instância Gerenciada ou o recurso Synapse do Azure no [portal do Azure](https://portal.azure.com).

2. No título **segurança** , selecione **central de segurança**.

3. Em seguida, clique em **Configurar** no link para abrir o painel de configurações do Azure defender para SQL para todo o servidor ou instância gerenciada.

    > [!NOTE]
    > A avaliação de vulnerabilidade do SQL requer que o **Azure defender para o plano do SQL** possa executar verificações. Para obter mais informações sobre como habilitar o Azure defender para SQL, consulte [Azure defender para SQL](azure-defender-for-sql.md).

4. Configure uma conta de armazenamento na qual os resultados da verificação para todos os bancos de dados no servidor ou instância gerenciada serão armazenados. Para saber mais sobre as contas de armazenamento, confira [Sobre as contas de armazenamento do Azure](../../storage/common/storage-account-create.md).

    > [!NOTE]
    > Para obter mais informações sobre como armazenar verificações de avaliação de vulnerabilidade por trás de firewalls e VNets, consulte [armazenar vulnerabilidades de exame de avaliação resulta em uma conta de armazenamento acessível por trás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).

5. Configure a avaliação de vulnerabilidade do SQL para executar automaticamente verificações periódicas recorrentes uma vez por semana para detectar automaticamente qualquer configuração incorreta de segurança de alteração. Para fazer isso, habilite **verificações recorrentes periódicas** na seleção da conta de armazenamento. Um resumo do resultado da verificação é enviado para os endereços de email que você fornecer em **enviar relatórios de verificação para** o. Você também pode enviar notificações por email para administradores e proprietários de assinatura habilitando **também notificação de email para administradores e proprietários de assinatura**.

6. A avaliação de vulnerabilidades do SQL pode executar a verificação sob demanda. Depois de configurar a avaliação de vulnerabilidades do SQL, selecione **examinar** para verificar se há vulnerabilidades no banco de dados.

![Examinar um banco de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > A verificação é leve e segura. Leva alguns segundos para ser executado e é inteiramente somente leitura. Ele não faz nenhuma alteração no banco de dados.

## <a name="remediate-vulnerabilities"></a>Corrigir vulnerabilidades

1. Quando a verificação for concluída, o relatório de verificação será exibido automaticamente na portal do Azure. O relatório apresenta uma visão geral do seu estado de segurança. Ele lista quantos problemas foram encontrados e suas respectivas severidades. Os resultados incluem avisos sobre desvios das práticas recomendadas e um instantâneo de suas configurações relacionadas à segurança, como entidades de banco de dados e funções, e suas permissões associadas.

![Exibir o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

2. Examine os resultados e determine quais conclusões no relatório são problemas de segurança reais em seu ambiente. Faça uma busca detalhada de cada resultado com falha para entender o impacto das descobertas e por que cada verificação de segurança falhou. Use as informações de correção acionáveis fornecidas pelo relatório para resolver problemas.

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

3. Ao examinar os resultados da avaliação, você pode marcar resultados específicos como uma linha de *base* aceitável em seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são registrados. Os resultados que correspondem à linha de base são considerados ao passar nas verificações posteriores. Depois de estabelecer seu estado de segurança de linha de base, a avaliação de vulnerabilidades só relata os desvios da linha de base. Dessa forma, você pode concentrar sua atenção nos problemas relevantes.

![Definir a linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

4. Depois de concluir a configuração das **linhas de base de regra**, execute uma nova verificação para exibir o relatório personalizado. A avaliação de vulnerabilidades agora relata apenas os problemas de segurança que se desviam do seu estado de linha de base aprovado.

![Exibir o relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

A Avaliação de Vulnerabilidades agora pode ser usada para monitorar se o banco de dados mantém um alto nível de segurança em todos os momentos e se as políticas organizacionais são atendidas. 

## <a name="advanced-capabilities"></a>Recursos avançados

### <a name="export-an-assessment-report"></a>Exportar um relatório de avaliação

Selecione **Exportar resultados da verificação** para criar um relatório do Excel para download do resultado da verificação. Este relatório contém uma guia Resumo que exibe um resumo da avaliação. O relatório inclui todas as verificações com falha. Ele também inclui uma guia **resultados** que contém o conjunto completo de resultados da verificação. Os resultados incluem todas as verificações que foram executadas e os detalhes de resultado de cada uma.

### <a name="view-scan-history"></a>Exibir o histórico de verificação

Selecione **histórico de verificação** no painel avaliação de vulnerabilidade para exibir um histórico de todas as verificações executadas anteriormente neste banco de dados. Selecione uma verificação específica na lista para exibir os resultados detalhados dessa verificação.

## <a name="manage-vulnerability-assessments-programmatically"></a>Gerenciar avaliações de vulnerabilidade programaticamente

### <a name="using-azure-powershell"></a>Usando o PowerShell do Azure

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo Azure Resource Manager do PowerShell ainda tem suporte, mas todo o desenvolvimento futuro é para o módulo AZ. Sql. Para esses cmdlets, confira [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Você pode usar os cmdlets do Microsoft Azure PowerShell para gerenciar suas avaliações de vulnerabilidade de forma programática. Os cmdlets com suporte são:

| Nome do cmdlet como um link | Descrição |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidade.<br/>Primeiro, defina a linha de base antes de usar este cmdlet para limpá-la. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidade de um banco de dados gerenciado.<br/>Primeiro, defina a linha de base antes de usar este cmdlet para limpá-la. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Limpa as configurações de avaliação de vulnerabilidade de uma instância gerenciada. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Converte os resultados da verificação de avaliação de vulnerabilidade de um banco de dados em um arquivo do Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Converte os resultados da verificação de avaliação de vulnerabilidade de um banco de dados gerenciado em um arquivo do Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a linha de base da regra de avaliação de vulnerabilidade de um banco de dados para uma determinada regra. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a linha de base da regra de avaliação de vulnerabilidade de um banco de dados gerenciado para uma determinada regra. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados gerenciado. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Retorna as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Retorna as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de avaliação de vulnerabilidade. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de avaliação de vulnerabilidade para um banco de dados gerenciado. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Dispara o início de uma verificação de avaliação de vulnerabilidade em um banco de dados. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Dispara o início de uma verificação de avaliação de vulnerabilidade em um banco de dados gerenciado. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de um banco de dados. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de um banco de dados gerenciado. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Atualiza as configurações de avaliação de vulnerabilidade de uma instância gerenciada. |
| &nbsp; | &nbsp; |

Para obter um exemplo de script, consulte [suporte do PowerShell de Avaliação de Vulnerabilidade de SQL do Azure](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Usando modelos do Resource Manager

Para configurar as linhas de base de avaliação de vulnerabilidade usando modelos de Azure Resource Manager, use o `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` tipo.

Certifique-se de que você tenha habilitado `vulnerabilityAssessments` antes de adicionar linhas de base.

Aqui está um exemplo para definir a regra de linha de base VA2065 para o `master` banco de dados e VA1143 para o `user` banco de dados como recursos em um modelo do Resource Manager:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Para `master` banco de dados e `user` banco de dados, os nomes de recursos são definidos de forma diferente:

- Banco de dados mestre-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]",
- User Database-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Default</b>')]",

Para tratar tipos booleanos como true/false, defina o resultado da linha de base com a entrada binária, como "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Próximas etapas  

- Saiba mais sobre o [Azure Defender para SQL](azure-defender-for-sql.md).
- Saiba mais sobre a [descoberta e a classificação de dados](data-discovery-and-classification-overview.md).
- Saiba como [armazenar os resultados da verificação de avaliação de vulnerabilidade em uma conta de armazenamento acessível por trás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).
