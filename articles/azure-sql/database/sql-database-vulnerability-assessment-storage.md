---
title: Armazenar os resultados da verificação de avaliação de vulnerabilidade em uma conta de armazenamento acessível por trás de firewalls e VNets
description: Fornece instruções sobre como armazenar verificações de VA (avaliação de vulnerabilidade) em uma conta de armazenamento que pode ser acessada por meio de um firewall ou de uma VNet
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: 83dbc04eb412d1e42fa8b42a3324c31a55db8adb
ms.sourcegitcommit: aacbf77e4e40266e497b6073679642d97d110cda
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/12/2021
ms.locfileid: "98116740"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>Armazenar os resultados da verificação de avaliação de vulnerabilidade em uma conta de armazenamento acessível por trás de firewalls e VNets
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Se você estiver limitando o acesso à sua conta de armazenamento no Azure para determinados VNets ou serviços, você precisará habilitar a configuração apropriada para que a verificação de avaliação de vulnerabilidade (VA) para bancos de dados SQL ou instâncias gerenciadas tenha acesso a essa conta de armazenamento.

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Habilitar o acesso de verificação de VA do banco de dados SQL do Azure à conta de armazenamento

Se você tiver configurado sua conta de armazenamento do VA para ser acessível somente por determinadas redes ou serviços, será necessário garantir que as verificações de VA para seu banco de dados SQL do Azure sejam capazes de armazenar as verificações na conta de armazenamento. Você pode usar a conta de armazenamento existente ou criar uma nova conta de armazenamento para armazenar os resultados da verificação de VA para todos os bancos de dados em seu [SQL Server lógico](logical-servers.md).

> [!NOTE]
> O serviço de avaliação de vulnerabilidade não poderá acessar contas de armazenamento protegidas com firewalls ou VNets se exigirem chaves de acesso de armazenamento.

Vá para o **grupo de recursos** que contém a conta de armazenamento e acesse o painel da **conta de armazenamento** . Em **configurações**, selecione **Firewall e redes virtuais**.

Verifique se **a opção permitir acesso de serviços da Microsoft confiável a esta conta de armazenamento** está marcada.

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="Captura de tela mostra a caixa de diálogo Firewall e redes virtuais, permitindo que os serviços confiáveis da Microsoft acessem essa conta de armazenamento selecionada.":::

Para descobrir qual conta de armazenamento está sendo usada, vá para o painel do **SQL Server** na [portal do Azure](https://portal.azure.com), em **segurança**, selecione **central de segurança**.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="configurar avaliação de vulnerabilidade":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Armazenar resultados da verificação de VA para o SQL do Azure Instância Gerenciada em uma conta de armazenamento que pode ser acessada por meio de um firewall ou rede virtual

Como Instância Gerenciada não é um serviço confiável da Microsoft e tem uma VNet diferente da conta de armazenamento, a execução de uma verificação de VA resultará em um erro.

Para dar suporte a verificações de VA em instâncias gerenciadas, siga as etapas abaixo:

1. No painel **instância gerenciada do SQL** , no cabeçalho **visão geral** , clique no link **rede virtual/sub-rede** . Isso leva você até o painel de **rede virtual** .

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="Mi-overview2":::

1. Em **Configurações**, selecione **Sub-redes**. Clique em **sub-rede** no painel novo para adicionar uma sub-rede e delegá-la para *Microsoft. sql\managedInstance*. Para obter mais informações, consulte [gerenciar sub-redes](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="Captura de tela mostra uma sub-rede que foi delegada Microsoft. sql\managedInstance.":::

1. No painel **rede virtual** , em **configurações**, selecione **pontos de extremidade de serviço**. Clique em **Adicionar** no painel novo e adicione o serviço *Microsoft. Storage* como um novo ponto de extremidade de serviço. Verifique se a sub-rede *ManagedInstance* está selecionada. Clique em **Adicionar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="A captura de tela mostra adicionar pontos de extremidade de serviço, em que você adiciona o serviço Microsoft. Storage como um EndPoint.":::

1. Vá para sua **conta de armazenamento** que você selecionou para armazenar as verificações de VA. Em **configurações**, selecione **Firewall e redes virtuais**. Clique em **Adicionar rede virtual existente**. Selecione sua rede virtual de instância gerenciada e sub-rede e clique em **Adicionar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="Captura de tela mostra o painel firewalls e redes virtuais, que contém o link Adicionar rede virtual existente.":::

Agora você deve ser capaz de armazenar as verificações de VA para instâncias gerenciadas na sua conta de armazenamento.

## <a name="next-steps"></a>Próximas etapas

- [Avaliação de Vulnerabilidade](sql-vulnerability-assessment.md)
- [Crie uma conta de Armazenamento do Azure](../../storage/common/storage-account-create.md)
- [Azure Defender para SQL](azure-defender-for-sql.md)
