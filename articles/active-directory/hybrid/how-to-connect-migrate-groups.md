---
title: 'Azure AD Connect: Migrar grupos de uma floresta para outra'
description: Este artigo descreve as etapas necessárias para migrar com êxito os grupos de uma floresta para outra para Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: how-to
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 5ef693a48dc52854e4e1fd8359ef24f65ce236f7
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/09/2020
ms.locfileid: "85358575"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrar grupos de uma floresta para outra para Azure AD Connect

Este artigo descreve como migrar grupos de uma floresta para outra para que os objetos de grupo migrados correspondam aos objetos existentes na nuvem.

## <a name="prerequisites"></a>Pré-requisitos

- Azure AD Connect versão 1.5.18.0 ou posterior
- Atributo de âncora de origem definido como `mS-DS-ConsistencyGuid`

## <a name="migrate-groups"></a>Migrar grupos

A partir da versão 1.5.18.0, Azure AD Connect dá suporte ao uso do `mS-DS-ConsistencyGuid` atributo para grupos. Se você escolher `mS-DS-ConsistencyGuid` como o atributo de âncora de origem e o valor for populado em Active Directory, Azure ad Connect usará o valor de `mS-DS-ConsistencyGuid` como `immutableId` . Caso contrário, ele retornará ao uso do `objectGUID` . Mas Observe que Azure AD Connect não grava o valor de volta para o `mS-DS-ConsistencyGuid` atributo em Active Directory.

Durante uma movimentação entre florestas, quando um objeto de grupo está mudando de uma floresta (digamos F1) para outra floresta (digamos que F2), você precisa copiar o `mS-DS-ConsistencyGuid` valor (se ele estiver presente) ou o `objectGUID` valor do objeto na floresta F1 para o `mS-DS-ConsistencyGuid` atributo do objeto em F2.

Use os scripts a seguir como um guia para saber como migrar um único grupo de uma floresta para outra. Você também pode usar esses scripts como um guia para a migração de vários grupos. Os scripts usam o nome da floresta F1 para a floresta de origem e F2 para a floresta de destino.

Primeiro, obtemos o `objectGUID` e o `mS-DS-ConsistencyGuid` do objeto de grupo na floresta F1. Esses atributos são exportados para um arquivo CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to the Export-Group script.
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Em seguida, usamos o arquivo CSV de saída gerado para carimbar o `mS-DS-ConsistencyGuid` atributo no objeto de destino na floresta F2:


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by the Import-Group script.
It copies either the objectGUID or the mS-DS-ConsistencyGuid value from the CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Próximas etapas
Saiba mais sobre como [integrar suas identidades locais com o Azure Active Directory](whatis-hybrid-identity.md).
